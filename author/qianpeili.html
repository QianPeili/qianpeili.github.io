<!DOCTYPE html>
<html lang="cn">
<head>
        <title>爪了个子 - Articles by QianPeili</title>
        <meta charset="utf-8" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://qianpeili.github.io/">爪了个子 <strong>我所见，我所想</strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="/archives.html">Archives</a></li>
            <li><a href="/categories.html">Categories</a></li>
            <li><a href="/tags.html">Tags</a></li>
        </ul></nav><!-- /#menu -->
<section id="content">
<h2>Articles by QianPeili</h2>

<ol id="post-list">
        <li><article class="hentry">
                <header> <h2 class="entry-title"><a href="http://qianpeili.github.io/gode-yi-lai-guan-li-gong-ju-govendor.html" rel="bookmark" title="Permalink to Go的依赖管理工具govendor">Go的依赖管理工具govendor</a></h2> </header>
                <footer class="post-info">
                    <time class="published" datetime="2017-05-22T18:11:00+08:00"> 周一 22 五月 2017 </time>
                    <address class="vcard author">By
                        <a class="url fn" href="http://qianpeili.github.io/author/qianpeili.html">QianPeili</a>
                    </address>
                </footer><!-- /.post-info -->
                <div class="entry-content"> <p>依赖管理是我接触 go 以来，觉得比较麻烦的事情。
不过在 go-1.5 版本中，出现了一个 <code>vendor</code> 的概念，并且 <code>vendor</code> 作为一个默认功能存在于1.7之后的版本中。</p>
<p>vendor的概念就类似于python中的 <code>virtualenv</code> 建立的 <code>env</code>，它是一个文件夹，里面存放了项目所用的依赖。如果项目中有个文件 import 了第三方的 package，而这个 package 又存在项目的 vendor 目录中，这个文件编译的时候会从 vendor 中 import 这个 package</p>
<p>比如：</p>
<div class="highlight"><pre><span></span>$GOPATH
|   src/
|   |   project/
|   |   |   main.go
|   |   |   vendor/
|   |   |   |   github.com/pkg/sftp/
|   |   |   |   golang.org/x …</pre></div> </div><!-- /.entry-content -->
        </article></li>
        <li><article class="hentry">
                <header> <h2 class="entry-title"><a href="http://qianpeili.github.io/unicodexiao-ji-qiao.html" rel="bookmark" title="Permalink to unicode小技巧">unicode小技巧</a></h2> </header>
                <footer class="post-info">
                    <time class="published" datetime="2017-04-07T10:20:00+08:00"> 周五 07 四月 2017 </time>
                    <address class="vcard author">By
                        <a class="url fn" href="http://qianpeili.github.io/author/qianpeili.html">QianPeili</a>
                    </address>
                </footer><!-- /.post-info -->
                <div class="entry-content"> <p>今天遇到一个问题</p>
<p>在mysql查询日志时，发现一些unicode字符串存储变成了</p>
<div class="highlight"><pre><span></span>u7528u6237u53d6u6d88u8ba2u5355u8bf7u6c42
</pre></div>


<p>这个形式，手动加<code>\</code>虽然可行，但毕竟不是长久的办法</p>
<p>所以最好的办法是将字符串中的内容，根据unicode格式转换成unicode</p>
<p>代码如下:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>   
<span class="n">a</span> <span class="o">=</span> <span class="s2">&quot;u7528u6237u53d6u6d88u8ba2u5355u8bf7u6c42&quot;</span>  
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;\u(.{4})&quot;</span><span class="p">)</span>    
<span class="n">maps</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>   
<span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">maps</span><span class="p">:</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="nb">unichr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="n">tmp</span>
<span class="k">print</span> <span class="n">s</span>
</pre></div>


<p>就会输出原先代表的文字意思了</p>
<p>注： 以上是代码是python2版本， python3需要把<code>unichr</code>改成<code>chr</code></p> </div><!-- /.entry-content -->
        </article></li>
        <li><article class="hentry">
                <header> <h2 class="entry-title"><a href="http://qianpeili.github.io/yong-mongodbtong-ji-qu-zhong-hou-de-shu-liang.html" rel="bookmark" title="Permalink to 用mongodb统计去重后的数量">用mongodb统计去重后的数量</a></h2> </header>
                <footer class="post-info">
                    <time class="published" datetime="2017-03-16T18:11:00+08:00"> 周四 16 三月 2017 </time>
                    <address class="vcard author">By
                        <a class="url fn" href="http://qianpeili.github.io/author/qianpeili.html">QianPeili</a>
                    </address>
                </footer><!-- /.post-info -->
                <div class="entry-content"> <p>假设有一个活动记录表，记录了玩家的参与信息，每个玩家有多条记录，格式如下</p>
<div class="highlight"><pre><span></span>{
    _id: ObjectId(),
    uid: 1014,
    score: 10
}
</pre></div>


<p>要求统计参与活动的玩家中，分数大于等于10的人数。</p>
<div class="highlight"><pre><span></span><span class="x">var num = db.activity_log.aggregate([</span>
<span class="x">    </span><span class="cp">{</span><span class="nv">$match</span><span class="o">:</span> <span class="cp">{</span><span class="s2">&quot;score&quot;</span><span class="o">:</span> <span class="cp">{</span><span class="s2">&quot;$ge&quot;</span><span class="o">:</span> <span class="m">10</span><span class="cp">}}}</span><span class="x">,  # 筛选</span>
<span class="x">    </span><span class="cp">{</span><span class="nv">$group</span><span class="o">:</span> <span class="cp">{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="o">,</span> <span class="s2">&quot;users&quot;</span><span class="o">:</span> <span class="cp">{</span><span class="nv">$addToSet</span><span class="o">:</span> <span class="s2">&quot;$uid&quot;</span><span class="cp">}}}</span><span class="x">,    # 将玩家ID放入一个集合，作去重</span>
<span class="x">    </span><span class="cp">{</span><span class="s2">&quot;$project&quot;</span><span class="o">:</span> <span class="cp">{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="cp">{</span><span class="s2">&quot;$size&quot;</span><span class="o">:</span> <span class="s2">&quot;$users&quot;</span><span class="cp">}}}</span><span class="x">    # 求集合大小</span>
<span class="x">]);</span>
</pre></div>


<p>得出结果<code>{"_id": 46}</code></p> </div><!-- /.entry-content -->
        </article></li>
        <li><article class="hentry">
                <header> <h2 class="entry-title"><a href="http://qianpeili.github.io/replace-type-code-with-statestrategy.html" rel="bookmark" title="Permalink to Replace Type Code With State/Strategy">Replace Type Code With State/Strategy</a></h2> </header>
                <footer class="post-info">
                    <time class="published" datetime="2016-12-26T20:55:00+08:00"> 周一 26 十二月 2016 </time>
                    <address class="vcard author">By
                        <a class="url fn" href="http://qianpeili.github.io/author/qianpeili.html">QianPeili</a>
                    </address>
                </footer><!-- /.post-info -->
                <div class="entry-content"> <p>今天在阅读《重构：改善既有代码的设计》第一个案例中，遇到了一个<strong>replace type code with state/strategy</strong>的概念，不是很了解，
但大概懂了意思。决定用<code>python</code>实现一下其代码。</p>
<p>觉得主要思想是：</p>
<p>一个对象(<code>Movie</code>)有一个属性(<code>price_code</code>)，这个属性的不同会导致对象的方法(<code>get_charge</code>)返回不同的结果。</p>
<p>最开始的想法肯定是用subclass进行分类，但是一部电影可以更换<code>price_code</code>，一个对象没法更换其所属类，所以直接建立一个<code>price</code>对象作为属性，改变<code>price_code</code>时，即改变了<code>price</code>对象。</p>
<p>重构前的代码：</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="nx">Movie</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span><span class="o">:</span>

    <span class="nx">REGULAR</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">NEW_RELEASE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="nx">CHILDRENS</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="nx">def</span> <span class="nx">__init__ …</span></pre></div> </div><!-- /.entry-content -->
        </article></li>
        <li><article class="hentry">
                <header> <h2 class="entry-title"><a href="http://qianpeili.github.io/my-first-review.html" rel="bookmark" title="Permalink to My First Review">My First Review</a></h2> </header>
                <footer class="post-info">
                    <time class="published" datetime="2016-12-05T16:20:00+08:00"> 周一 05 十二月 2016 </time>
                    <address class="vcard author">By
                        <a class="url fn" href="http://qianpeili.github.io/author/qianpeili.html">QianPeili</a>
                    </address>
                </footer><!-- /.post-info -->
                <div class="entry-content"> <p>好吧，打扫一下，准备吧github page重新用起来</p>
<p>这次没用hexo，用了pelican啦~</p> </div><!-- /.entry-content -->
        </article></li>
</ol><!-- /#posts-list -->
</section><!-- /#content -->
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>